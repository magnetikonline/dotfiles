# ~/.bashrcmagnetik
# called from ~/.bashrc as [ . "$HOME/.bashrcmagnetik" ]


umask 022


# load SSH keys into agent
find "$HOME/.ssh" -type f -name "id_rsa*" ! -name "*.pub" -print0 | \
	xargs --null --replace={} ssh-add "{}" &>/dev/null


# colored shell prompt including Git branch details
GIT_PS1_SHOWDIRTYSTATE="true"
PS1='${debian_chroot:+($debian_chroot)}\[\033[00;32m\]\u\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]$(__git_ps1 " \[\033[00;95m\](%s)\[\033[00m\]")\$ '


# working directory as xterm title
[[ $TERM =~ ^(xterm-color|.+-256color)$ ]] && PS1="$PS1\[\033]0;\w\007\]"


# application shortcuts
alias diff='git diff --no-index'
alias dockviz='docker run --interactive --rm --tty --volume /var/run/docker.sock:/var/run/docker.sock nate/dockviz'
alias m='meld'
alias n='nano'
alias s='subl'
alias tigs='tig status'


# utility commands
alias mag-fixfileperms='chmod -R a-rwx,a+rX,u+w . && \
	find . -type f -name "*.sh" -print0 | xargs --no-run-if-empty --null --replace={} chmod 0744 "{}" && \
	find . -type f \( -name "id_rsa" -or -name "*.id_rsa" \) -print0 | xargs --no-run-if-empty --null --replace={} chmod 0600 "{}"'

alias mag-dockernukecontainers='docker ps --filter "status=exited" --quiet | \
	xargs --no-run-if-empty --replace={} docker rm "{}"'

alias mag-dockernukeimagesuntagged='docker images --filter "dangling=true" --quiet | \
	xargs --no-run-if-empty --replace={} docker rmi "{}"'

alias mag-findcrlf='grep --binary --binary-files without-match --files-with-matches --recursive $'\''\r'\'' .'
alias mag-gitrebasesubl='EDITOR="subl -nw" git rebase --interactive'
alias mag-shutdown='sudo shutdown now -P'
alias mag-sysupdate='sudo apt update && sudo apt upgrade'
